# Обзор проекта

Revie Router — это современное веб-приложение, которое использует ИИ Mistral для создания всесторонних, насыщенных обзоров продуктов и книг. Приложение предоставляет пользователям интуитивно понятную платформу для создания подробных обзоров с помощью ИИ-помощника, настраиваемыми подсказками и элегантным современным интерфейсом. Созданное с использованием бэкэнда Go и фронтэнда Tailwind CSS, оно предлагает бесперебойный опыт создания высококачественных обзоров с помощью расширенных моделей ИИ.

# Функции

## Генерация обзоров на основе ИИ
- **Интеграция ИИ Mistral**: использует расширенные модели AI (`mistral-large-2411` и `magistral-medium-2506` с режимом рассуждений)
- **Пользовательские Промты**: создает, управляет и использует персонализированные шаблоны подсказок для разных типов отзывов
- **Расширенная работа с отзывами**: с помощью ии можно уточнять или расширять отзывы (например придумать заголовок)
- **Управление обзорами**: полный CRUD для отзывов с системой избранного

## Система учетных записей пользователей
- **Аутентификация JWT**: безопасная аутентификация на основе токенов с доступом и токенами обновления
- **Регистрация и вход пользователя**: простая система аутентификации имени пользователя и пароля
- **Персональные настройки**: сохранение пресетов, памяти, системный промт и запроса по умолчанию
- **Система избранного**: отмечайте и организуйте избранные обзоры для легкого доступа

## Современный пользовательский интерфейс
- **Темная тема**: элегантная современная темная тема, оптимизированная для длительного использования
- **Поддержка Markdown**: полная отрисовка markdown с подсветкой синтаксиса
- **Интуитивно понятная навигация**: навигация по боковой панели с организованным доступом к обзорам

## Расширенная настройка
- **Настройка подсказок**: переопределение системных подсказок по умолчанию с помощью личных настроек
- **Шаблоны обзоров**: сохранение и повторное использование общих структур обзоров
- **Редактируемый контент**: полные возможности редактирования для созданных обзоров и заголовков
- **Очередь задач**: Управляется в `internal/queue/queue.go`, обеспечивая эффективную обработку задач ИИ
- **Управление памятью**: Работа с памятью пользователя через `internal/database/brain.go`, обновление и хранение
- **Миграции БД**: Выполняются через папку `db/migrations`, позволяет изменять схему БД без потерь данных


# Технологический стек

## Backend
- **Go** 1.24.4+ - Язык программирования
- **Chi Router** - Легкий HTTP-маршрутизатор
- **PostgreSQL** 12+ - Основная база данных
- **pgx/v5** - Драйвер PostgreSQL
- **golang-migrate** - миграция базы данных
- **JWT** - Токены аутентификации
- **Mistral AI** - Генерация отзывов на основе ИИ
- **Taskfile** - Удобное формирование команд 
- **godotenv**: Поддержка переменных окружения
- **Taskfile**: Автоматизация общих задач с помощью `taskfile.yml`
- **Queuing**: Работа с очередями в `internal/queue/queue.go`

## Frontend
- **HTML/CSS/JavaScript** - Основные веб-технологии
- **Tailwind CSS** - Utility-first CSS-фреймворк
- **Markdown** - Форматирование контента отзывов
- **Файлы оболочки**: Скрипты для миграции базы данных и тестов
# Установка и развертывание
Перед установкой и запуском приложения убедитесь, что у вас установлено следующее по:

## Необходимое программное обеспечение
- **Go 1.24.4 или выше** - [Загрузить с официального сайта](https://golang.org/dl/)
- **PostgreSQL 12 или выше** - [Руководство по установке](https://www.postgresql.org/download/)
- **Git** - Для клонирования репозитория

## Дополнительные инструменты
- **Docker и Docker Compose** - Для контейнерного развертывания (необязательно)
- **Nginx/Apache** - Для настройки обратного прокси (лучше использовать для собственного домена)

## Проверка установки
```bash
# Проверка версии Go
go version

# Проверка версии PostgreSQL
psql --version

# Проверка версии Git
git --version
```

# Установка

## 1. Клонирование репозитория
```bash
git clone https://github.com/nikaydo/ReviewerBackend.git
cd "ReviewerBackend"
```

## 2. Загрузка зависимостей Go
```bash
go mod download
```

## 3. Настройка базы данных PostgreSQL

### Создание базы данных и пользователя
```sql
-- Подключение к PostgreSQL как суперпользователь
psql -U postgres

-- Создание базы данных
CREATE DATABASE mydb;

-- Создание пользователя с паролем
CREATE USER myuser WITH ENCRYPTED PASSWORD 'mypassword';

-- Предоставление привилегий
GRANT ALL PRIVILEGES ON DATABASE mydb TO myuser;
GRANT ALL ON SCHEMA public TO myuser;

-- Выход из psql
\q
```
### Схема базы данных
Приложение автоматически создает необходимые таблицы при запуске:
- **Таблица пользователей** - Аутентификация пользователей и управление учетными записями
- **Таблица отзывов** - Хранилище сгенерированных отзывов
- **Таблица вопросов по отзывам** - Вопросы по отзывам
- **Таблица настроек пользователя** - Персональные настройки и запросы по умолчанию
- **Таблица пользовательских шаблонов** - Шаблоны запросов, определяемые пользователем

*Примечание: создание схемы базы данных выполняется приложением автоматически во время инициализации используя миграции.*

# Конфигурация (переменные среды)

## 1. Создание файла среды
```bash
cp .env .env.backup # Резервное копирование существующего, если он есть
# Создание нового файла .env со следующими переменными:
```

## 2. Переменные среды
Создайте файл `.env` в корне проекта со следующей конфигурацией:
```
# Секреты JWT
SECRET=jwt ключь
SECRET_REFRESH=jwt ключь для рефрешь токена
SECRET_TTL=60 # Время жизни токена доступа (минуты)
REFRESH_TTL=600 # Время жизни токена обновления (минуты)

# Конфигурация базы данных
POSTGRESS_ADDR=postgres://myuser:mypassword@localhost:5432/mydb
DB_USER=users_table_name # Имя таблицы для пользователей
DB_USER_SETTING=user_settings # Имя таблицы для настроек пользователя
DB_REVIEW=reviews # Имя таблицы для отзывов
DB_REVIEW_ASK=review_requests # Имя таблицы для запросов отзывов
DB_USER_PROMT=custom_prompts # Имя таблицы для пользовательских подсказок

# Сеанс Конфигурация
COCKIE_TTL=1200 # Срок действия cookie (минуты)

# Конфигурация очереди
QUEUE_TIMEOUT_CHECK=3000 #Длительность паузы между проверками очереди если она пустая пустая (миллисекунды)
QUEUE_TIMEOUT_BETWEN_RESPONSE=1000 #Длительность паузы между обработкой запросов между паузами обрабатываеться QUEUE_SAME_TIME_PROCESSED раз (миллисекунды)
QUEUE_SAME_TIME_PROCESSED=2 #Количество одновременно обрабатываемых запросов из очереди

# Конфигурация сервера
HOST=localhost # Хост сервера
PORT=8080 # Порт сервера

# Интеграция ИИ
MISTRAL_API_KEY=ключь апи mistral

# Подсказка AI по умолчанию 
MAIN_PROMT_DEFAULT=Вы - ИИ, который пишет Комментарии, ...
PROMPT_FOR_MEMORIZATION=Ты - ассистент, который помогает ИИ ...
```
### Переменные среды Объяснение

| Переменная | Описание | Пример значения |
|----------|-------------|----------------|
| `SECRET` | Секретный ключ токена доступа JWT | `your_secure_secret_key` |
| `SECRET_REFRESH` | Секретный ключ токена обновления JWT | `your_refresh_secret_key` |
| `SECRET_TTL` | Срок действия токена доступа (минуты) | `60` |
| `REFRESH_TTL` | Срок действия токена обновления (минуты) | `600` |
| `POSTGRESS_ADDR` | Строка подключения PostgreSQL | `postgres://user:pass@host:port/db` |
| `DB_USER` | Имя таблицы пользователей | `users` |
| `DB_USER_SETTING` | Имя таблицы настроек пользователя | `user_settings` |
| `DB_REVIEW` | Имя таблицы отзывов | `reviews` |
| `DB_REVIEW_ASK` | Имя таблицы запросов отзывов | `review_requests` |
| `DB_USER_PROMT` | Имя таблицы пользовательских подсказок | `custom_prompts` |
| `COCKIE_TTL` | Время жизни сеансового cookie (минуты) | `1200` |
| `HOST` | Адрес привязки сервера | `localhost` или `0.0.0.0` |
| `PORT` | Порт сервера | `8080` |
| `MISTRAL_API_KEY` | Ключ API Mistral AI | `your_mistral_key` |
| `MAIN_PROMT_DEFAULT` | Шаблон подсказки AI по умолчанию | Текст пользовательской подсказки |
| `PROMPT_FOR_MEMORIZATION` | Шаблон подсказки памяти AI по умолчанию | Текст пользовательской подсказки |
| `QUEUE_TIMEOUT_CHECK`| Время в миллисекундах между между проверками наличия в очереди | `3000` |
| `QUEUE_TIMEOUT_BETWEN_RESPONSE` | Время между итерациями очереди в миллисекундах | `1000` |
| `QUEUE_SAME_TIME_PROCESSED` | Количество одновременоо обрабатывемых запросов в очереди коль-во| `1` |

# Запуск приложения

## Режим разработки
```bash
# Запуск напрямую с Go
go run main.go

# Сервер запустится на http://localhost:8080
```

## Сборка исполняемого файла
```bash
# Сборка приложения
go build -o ReviewerBackend main.go

# Запуск собранного исполняемого файла
./ReviewerBackend
```

## Проверка запуска приложения
```bash
#Открыть в браузере
open http://localhost:8080
```

# Ссылки API (таблица эндпоинтов)

### Неаутентифицированные маршруты
- `GET /` - Обслуживание страницы входа/регистрации (index.html)
- `POST /signin` - Вход пользователя
- `POST /signup` - Регистрация пользователя

### Аутентифицированные маршруты (требуется JWT)
Все маршруты в `/user` требуют аутентификации JWT через промежуточное ПО

#### Панель управления пользователя
- `GET /user/` - Обслуживает страницу панели управления пользователя (user.html)

#### Настройки пользователя
- `GET /user/setting/` - Получить настройки пользователя
- `PUT /user/setting/` - Обновить существующие настройки пользователя

#### Управление отзывами
- `GET /user/review/` - Получить все отзывы пользователя
- `POST /user/review/` - Создать новый отзыв 
- `PUT /user/review/` - Обновить существующее содержимое отзыва
- `DELETE /user/review/` - Удалить отзыв
- `POST /user/review/favorite` - Отметить/снять отметку отзыва как избранного
- `POST /user/review/mainpromt` - Обновить основной запрос для пользователя

#### Заголовки отзывов
- `POST /user/review/ask/` - Сгенерировать заголовок AI для отзыва
- `PUT /user/review/ask/` - Обновить заголовок отзыва
- `POST /user/brain/` - Обновление информации о пользователе в памяти
- `GET /user/brain/` - Получение состояния памяти пользователя

#### Пользовательские запросы
- `GET /user/custom/` - Получить пользовательские запросы
- `POST /user/custom/` - Добавить новый пользовательский запрос
- `PUT /user/custom/` - Обновить существующий пользовательский запрос
- `DELETE /user/custom/` - Удалить пользовательский запрос
